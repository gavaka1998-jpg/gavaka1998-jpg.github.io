<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>TON FORGE</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      background:#0f172a;
      color:#fff;
      font-family:Arial, sans-serif;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:48px 16px;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    .wrap{width:100%;max-width:420px;text-align:center;position:relative}

    h1{margin:0 0 18px 0;font-size:34px}

    /* ВАЖНО: этот блок НЕ должен перекрывать клики */
    #loading{
      margin:12px auto 14px auto;
      opacity:.85;
      font-size:14px;
      background:rgba(255,255,255,.06);
      padding:10px 12px;
      border-radius:12px;
      pointer-events:none; /* <-- ключевой фикс */
    }

    .btn{
      width:100%;
      padding:16px;
      margin:12px 0;
      font-size:20px;
      border:none;
      border-radius:16px;
      cursor:pointer;
      position:relative;
      z-index:5; /* <-- чтобы быть выше любых слоёв */
    }
    .up{background:#38bdf8;color:#05202a}
    .wd{background:#22c55e;color:#05202a}

    #counter{
      margin-top:14px;
      font-size:13px;
      opacity:.8;
      background:rgba(255,255,255,.06);
      padding:10px 12px;
      border-radius:12px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>🔥 TON FORGE</h1>
    <div id="loading">Готово. Нажми кнопку — счётчик должен увеличиться.</div>

    <button id="upgrade" class="btn up" type="button">Апгрейд</button>
    <button id="withdraw" class="btn wd" type="button">Вывод</button>

    <div id="counter">Нажатий: 0</div>
  </div>

  <script>
    let clicks = 0;
    const counter = document.getElementById("counter");

    function bump(tag){
      clicks++;
      counter.textContent = "Нажатий: " + clicks + " (последнее: " + tag + ")";
    }

    const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
    if (tg){
      try { tg.ready(); tg.expand(); } catch(e){}
    }

    function send(tag){
      bump(tag);

      // Если tg есть — покажем alert в Telegram (если не покажет, всё равно счётчик меняется)
      if (tg && tg.showAlert){
        try { tg.showAlert("Нажато: " + tag); } catch(e){}
      } else {
        // если вдруг открыто не в Telegram
        alert("Нажато: " + tag);
      }

      // отправка данных в бота
      if (tg && tg.sendData){
        try {
          tg.sendData(JSON.stringify({action: tag, ts: Date.now()}));
          // tg.close(); // можно включить, если хочешь закрывать сразу
        } catch(e){
          if (tg.showAlert) tg.showAlert("sendData ошибка: " + e);
        }
      }
    }

    function bind(id, tag){
      const el = document.getElementById(id);

      // Ловим ВСЁ: pointer/touch/click
      el.addEventListener("pointerup", (e)=>{ e.preventDefault(); send(tag); }, {passive:false});
      el.addEventListener("touchend", (e)=>{ e.preventDefault(); send(tag); }, {passive:false});
      el.addEventListener("click",    (e)=>{ e.preventDefault(); send(tag); }, {passive:false});
    }

    bind("upgrade", "upgrade");
    bind("withdraw", "withdraw");
  </script>
</body>
</html>